<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise de Veículos</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.min.js"></script>
    <style>
        /* Estilizar fundo da tela inicial */
        #home {
            background-image: url('https://images.unsplash.com/photo-1541348263662-e068662d82af?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            height: 100vh;
        }
        /* Ajustar menu lateral */
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Menu Lateral -->
    <div class="fixed inset-y-0 left-0 w-64 bg-blue-900 text-white sidebar z-10" id="sidebar">
        <div class="p-4">
            <h1 class="text-2xl font-bold">Análise de Veículos</h1>
        </div>
        <nav class="mt-4">
            <a href="#" class="block py-2 px-4 hover:bg-blue-700" onclick="showSection('home')">Início</a>
            <a href="#" class="block py-2 px-4 hover:bg-blue-700" onclick="showSection('upload')">Upload</a>
            <a href="#" class="block py-2 px-4 hover:bg-blue-700" onclick="showSection('reports')">Relatórios</a>
            <a href="#" class="block py-2 px-4 hover:bg-blue-700" onclick="showSection('about')">Sobre</a>
        </nav>
    </div>

    <!-- Botão de Menu para Mobile -->
    <button class="md:hidden fixed top-4 left-4 z-20 p-2 bg-blue-900 text-white rounded" onclick="toggleSidebar()">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>

    <!-- Conteúdo Principal -->
    <div class="ml-0 md:ml-64 p-6 transition-all">
        <!-- Tela Inicial -->
        <section id="home" class="min-h-screen flex items-center justify-center text-white">
            <div class="text-center bg-black bg-opacity-50 p-8 rounded-lg">
                <h1 class="text-4xl font-bold mb-4">Bem-vindo à Análise de Veículos</h1>
                <p class="text-lg">Gerencie e analise dados de viaturas com facilidade.</p>
            </div>
        </section>

        <!-- Seção de Upload -->
        <section id="upload" class="hidden">
            <h2 class="text-2xl font-bold mb-4">Upload de Planilha</h2>
            <form id="uploadForm" enctype="multipart/form-data" class="bg-white p-6 rounded-lg shadow-md">
                <input type="file" id="fileInput" name="file" accept=".xlsx" class="mb-4 p-2 border rounded">
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Enviar</button>
            </form>
        </section>

        <!-- Seção de Relatórios -->
        <section id="reports" class="hidden">
            <h2 class="text-2xl font-bold mb-4">Relatórios por Data</h2>
            <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                <select id="dateSelect" class="p-2 border rounded mb-4"></select>
                <button onclick="loadReport()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Carregar Relatório</button>
            </div>
            <h3 class="text-xl font-semibold mb-2">Relatório</h3>
            <table id="reportTable" class="w-full bg-white rounded-lg shadow-md">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="p-2 text-left">Marca</th>
                        <th class="p-2 text-left">Quantidade</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <h3 class="text-xl font-semibold mt-6 mb-2">Gráfico</h3>
            <canvas id="chart" class="max-w-lg"></canvas>
        </section>

        <!-- Seção Sobre -->
        <section id="about" class="hidden">
            <h2 class="text-2xl font-bold mb-4">Sobre o Projeto</h2>
            <div class="bg-white p-6 rounded-lg shadow-md">
                <p class="text-lg">Este projeto permite a análise de dados de viaturas a partir de planilhas Excel. Faça upload de planilhas diárias e visualize relatórios detalhados e gráficos interativos.</p>
                <p class="mt-4">Desenvolvido com Flask, MongoDB Atlas, e Tailwind CSS.</p>
            </div>
        </section>
    </div>

    <script>
        // Mostrar/Esconder seções
        function showSection(sectionId) {
            document.querySelectorAll('section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            if (window.innerWidth < 768) {
                toggleSidebar(); // Fechar menu em mobile
            }
            if (sectionId === 'reports') {
                loadDates(); // Carregar datas ao abrir relatórios
            }
        }

        // Alternar menu lateral em mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Carregar datas disponíveis
        function loadDates() {
            fetch('/dates')
                .then(response => response.json())
                .then(data => {
                    const dateSelect = document.getElementById('dateSelect');
                    dateSelect.innerHTML = '';
                    data.dates.forEach(date => {
                        const option = document.createElement('option');
                        option.value = date;
                        option.textContent = date;
                        dateSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Erro ao carregar datas:', error);
                    alert('Erro ao carregar datas');
                });
        }

        // Enviar planilha
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData();
            const fileInput = document.getElementById('fileInput');
            formData.append('file', fileInput.files[0]);

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    return;
                }
                showSection('reports');
                updateTable(data.report);
                updateChart(data.chart);
                loadDates();
            })
            .catch(error => {
                console.error('Erro ao enviar arquivo:', error);
                alert('Erro ao enviar arquivo');
            });
        });

        // Carregar relatório
        function loadReport() {
            const date = document.getElementById('dateSelect').value;
            if (!date) return;

            fetch(`/report/${date}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                        return;
                    }
                    updateTable(data.report);
                    updateChart(data.chart);
                })
                .catch(error => {
                    console.error('Erro ao carregar relatório:', error);
                    alert('Erro ao carregar relatório');
                });
        }

        // Atualizar tabela
        function updateTable(report) {
            const tbody = document.querySelector('#reportTable tbody');
            tbody.innerHTML = '';
            for (const [marca, quantidade] of Object.entries(report)) {
                const row = document.createElement('tr');
                row.innerHTML = `<td class="p-2">${marca}</td><td class="p-2">${quantidade}</td>`;
                tbody.appendChild(row);
            }
        }

        // Atualizar gráfico
        let chartInstance = null;
        function updateChart(chartData) {
            const ctx = document.getElementById('chart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: 'Quantidade por Ano Modelo',
                        data: chartData.values,
                        backgroundColor: 'rgba(37, 99, 235, 0.2)',
                        borderColor: 'rgba(37, 99, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // Mostrar tela inicial por padrão
        showSection('home');
    </script>
</body>
</html>